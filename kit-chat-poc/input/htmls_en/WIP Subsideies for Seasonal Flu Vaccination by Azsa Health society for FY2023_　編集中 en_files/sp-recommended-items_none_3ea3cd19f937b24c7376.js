define("279431a4-68f1-402c-ab81-ad5442f14179_0.1.0",["tslib","@ms/sp-telemetry","@ms/office-ui-fabric-react-bundle","@ms/odsp-core-bundle","@ms/sp-component-utilities","@microsoft/sp-diagnostics","@microsoft/sp-http","@ms/odsp-utilities-bundle"],function(n,a,i,r,o,s,c,d){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="mwqp")}({"17wl":function(e,t){e.exports=n},"2q6Q":function(e,t){e.exports=a},"5pbq":function(e,t){e.exports=i},K9kD:function(e,t){e.exports=r},"hiL/":function(e,t){e.exports=o},mwqp:function(e,t,n){"use strict";n.r(t),n.d(t,"CONSTS",function(){return a}),n.d(t,"recommendedItemsSurface",function(){return i}),n.d(t,"RecommendedItemsDataProvider",function(){return p}),n.d(t,"getRankingTag",function(){return m}),n.d(t,"FeedbackProvider",function(){return b});var a={defaultItemsCount:8},i="SharePoint Page Web",r=n("17wl"),o=n("5pbq"),s=n("vlQI"),c=n("y88i"),d=n("ut3N"),l=n("hiL/"),u=new l.KillSwitch("23e89a20-55cb-4c32-ae4c-511365e6f483"),f=function(){function e(){}return e.getApplicableReason=function(t,n){if(0===t.itemIndex||1===t.itemIndex)t.reason="ReadNext";else{if(u.isActivated())return e._getRandomReason(t,n);t.reason=e._getPrioritizedReason(t,n)}return t},e._getPrioritizedReason=function(e,t){return e.recommendation.itemReadByManager?"ManagerReadThis":e.commentCount>0?"Comments":e.likeCount>0?"Likes":e.isTrending?"Trending":e.sharepointIds.siteId.toLowerCase()===t.siteId.toString().toLowerCase()?"Popular":"LastEdited"},e._getRandomReason=function(e,t){var n=this._getReasons(e,t),a=n.length-1,i=Math.floor(Math.random()*(a-0+1))+0;return e.reason=n[i],e},e._getReasons=function(e,t){var n=[];return e.commentCount>0&&n.push("Comments"),e.likeCount>0&&n.push("Likes"),e.recommendation.itemReadByManager&&n.push("ManagerReadThis"),e.isTrending&&n.push("Trending"),e.sharepointIds.siteId.toLowerCase()===t.siteId.toString().toLowerCase()&&n.push("Popular"),n.push("LastEdited"),n},e}(),p=function(){function e(e){this.id="RecommendedItems",this.title="RecommendedItemsDataProvider",this._spHttpClient=e.serviceScope.consume(s.SPHttpClient.serviceKey)}return e.prototype.requestData=function(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t,n,a,i;return Object(r.__generator)(this,function(r){return t=e.qosMonitor,n=new d._QosMonitor("RecommendedItems.RecommendedItemAPI"),a=new c.Uri("".concat(window.location.origin,"/_api/v2.1/sites('").concat(window.location.hostname,",").concat(e.siteId,",").concat(e.webId,"')/lists('").concat(e.listId,"')/items('").concat(e.uniqueId,"')/driveItem/recommendedItems?$expand=analytics($expand=allTime,lastSevenDays)")),i="LightGBM",a.setQueryParameter("select","id,lastModifiedBy,lastModifiedDateTime,name,parentReference,webUrl,sharepointIds,recommendation,description,reactions,followed"),a.setQueryParameter("filter","recommendation/itemRankingScore gt 0.5"),e.count&&a.setQueryParameter("top",e.count.toString()),[2,this._spHttpClient.get(a.toString(),s.SPHttpClient.configurations.v1,{headers:{RankingAlgo:i}}).then(this._checkResponseStatus,function(e){throw e instanceof TypeError&&(n.writeExpectedFailure("ServerUnreachable",e),t.writeExpectedFailure("ServerUnreachable",e)),e}).then(function(a){return a.value?(n.writeSuccess(),a.value.map(function(t,n){var r=t.lastModifiedBy.user,o=r.displayName,s=r.email,c=t.analytics.allTime.access,d=t.analytics.lastSevenDays.isTrending,l=t.reactions,u=l.likeCount,p=l.commentCount,m=!!t.followed,_={name:t.name,siteTitle:t.parentReference.siteTitle,path:t.parentReference.path,webUrl:t.webUrl,lastModifiedUserName:o,lastModifiedUserEmail:s,lastModifiedDateTime:t.lastModifiedDateTime,sharepointIds:t.sharepointIds,recommendation:t.recommendation,viewerCount:c.actorCount,viewCount:c.actionCount,likeCount:u||0,commentCount:p||0,isTrending:d,itemIndex:n,description:t.description,correlationId:a.correlationId.toString(),rankingAlgo:i,followed:m,reason:void 0};return f.getApplicableReason(_,e)})):(n.writeUnexpectedFailure("UndefinedValue"),t.writeUnexpectedFailure("UndefinedValue"),Promise.resolve([]))},function(e){if(!(e instanceof TypeError)){var a=e.code.toLowerCase();"notsupported"===a||"usertypenotsupported"===a?(n.writeExpectedFailure("NotSupported",e),t.writeExpectedFailure("NotSupported",e)):(n.writeUnexpectedFailure("RequestFailure",e),t.writeUnexpectedFailure("RequestFailure",e))}return Promise.resolve([])}).catch(function(e){return n.writeUnexpectedFailure("UnknownError",e),t.writeUnexpectedFailure("UnknownError",e),Promise.resolve([])})]})})},e.prototype._checkResponseStatus=function(e){return e.ok?e.json().then(function(t){return{correlationId:e.correlationId,value:t.value}}):e.json().then(function(t){return Promise.reject({status:e.status,requestId:e.correlationId,code:t.error.code,message:t.error.message})})},Object(r.__decorate)([o.autobind],e.prototype,"_checkResponseStatus",null),e}();function m(){return"LightGBM"}var _=n("K9kD"),h=n("2q6Q"),b=function(){function e(e){this._spHttpClient=e.serviceScope.consume(s.SPHttpClient.serviceKey)}return e.prototype.dismissItem=function(e,t,n){var a=new d._QosMonitor("RecommendedItems.FeedbackDirectAPI"),i=new _.SPResourcePath(e.web.absoluteUrl+"/_api/web/ActivityLogger/FeedbackDirect"),o=new _.SPResourcePath(n.itemUrl),c=o.segments.slice(0,o.segments.length-1).join("/"),u=l.ExtensionHelper.getExtension(n.itemUrl),f={Operation:"RecommendationDismissed",ListId:n.sharepointIds.listId,ListItemUniqueId:n.sharepointIds.listItemUniqueId,AffectedResourceUrl:n.itemUrl,ItemType:"Page",json:JSON.stringify({FileName:o.segments[o.segments.length-1],Scenario:"ItemToItem",SourceRelativeUrl:c,DismissRecommendationsCategory:"Discovery",PositionNumber:n.itemIndex.toString(),TotalRecommendationsPresented:"8",RankingAlgorithm:"LightGBM",RecommendationAlgorithmVersion:"1",Operation:"RecommendationDismissed",ItemRankingScore:n.recommendation.itemRankingScore.toString(),ItemPopularityScore:n.recommendation.itemPopularityScore.toString(),ItemRelevantPeopleCount:n.recommendation.itemRelevantPeopleCount.toString(),ReferringCorrelationId:n.correlationId,Canvas:"NA",Workload:"SharePoint",WebId:n.sharepointIds.webId,SiteId:n.sharepointIds.siteId,SiteUrl:e.web.absoluteUrl,ClientLocalTime:(new Date).toISOString(),ClientUTCOffsetInMinutes:(new Date).getTimezoneOffset(),SourceFileName:o.segments[o.segments.length-1],SourceFileExtension:u,ReferringSiteId:t.siteId,ReferringListId:t.listId,ReferringWebId:t.webId,ReferringDocumentId:t.docId})};this._spHttpClient.post(i.value,s.SPHttpClient.configurations.v1,{body:JSON.stringify(f)}).then(this._handleErrors,function(e){throw e instanceof TypeError&&a.writeExpectedFailure("ServerUnreachable",e),e}).then(function(e){e.ok?(a.writeSuccess(),h._EngagementLogger.logEventWithLogEntry(new d._LogEntry("RecommendedItems","Dismissed",d._LogType.Event,Object(r.__assign)({activity:n.activity,itemIndex:n.itemIndex.toString()},n.sharepointIds),!1))):a.writeUnexpectedFailure("RequestFailure",void 0,{correlationId:e.correlationId,status:e.status})}).catch(function(e){e instanceof TypeError||a.writeUnexpectedFailure("UnknownError",e)})},e.prototype._handleErrors=function(e){return e.ok?Promise.resolve(e):Promise.reject(e)},e}()},ut3N:function(e,t){e.exports=s},vlQI:function(e,t){e.exports=c},y88i:function(e,t){e.exports=d}})});